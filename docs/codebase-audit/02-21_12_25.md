This review focuses on codebase hygiene, performance scalability, and architectural consistencyâ€”areas that weren't covered in the previous feature/bug discussions but are critical for a "Professional V3" codebase.

### **1. Codebase Hygiene & Cleanup**

**Observation:** The file structure contains significant "dead code" and experimental artifacts. This bloat slows down IDE indexing, confuses new developers (or you in 6 months), and increases the bundle size if imports leak.

* **Duplicate Components:** You have `Navbar.tsx`, `Navbar2.tsx`, and `Navbar3.tsx` in `dashboard/_components`.
* **"Old" Files:** Several files are explicitly named `oldAnalyticsPage.tsx`, `oldExportData.tsx`, `oldGoalsPage.tsx`.
* **Redundant Folder:** The `hooks/new/redundent` folder is explicitly tracking tech debt.

**Improvement:** Delete these files immediately. If you are afraid of losing them, the git history (or your "Private Dev Repo") is your backup. Do not ship them in the `main` branch.

### **2. Architecture: Finish the Adapter Pattern**

**Observation:** Your Roadmap explicitly mentions: *"Data-Adapter Refactor: Fully move data-adapter logic from hooks into `lib/adapter.ts`"*.
Currently, data transformation logic seems scattered between `hooks/useSessionsQuery.ts` and components.

**Improvement:** Centralize all Firestore-to-UI type transformations in `lib/adapter.ts`. This ensures that if you change your DB schema (e.g., adding `tags`), you only update the adapter, not 10 different components.

### **3. Performance: Analytics Scalability**

**Observation:** The Analytics page likely iterates over the entire `sessions` array to calculate totals and streaks on every render.

* **Risk:** As a user logs 1,000+ sessions, this calculation will block the main thread, causing UI lag.
* **Related:** Issue 11 (removing DB fields) puts *more* load on the client to calculate durations.

**Improvement:**

1. **Memoization:** Ensure all analytics calculations are wrapped in `useMemo`.
2. **Worker Offloading (Future):** For very large datasets, move heavy aggregation (like "Yearly Heatmap") to a Web Worker or keep a "Stats" document in Firestore that aggregates totals on-write (Cloud Function).

### **4. Redundant Sync Logic**

**Observation:** You have `hooks/useTabSync.ts` alongside `lib/firebase.ts` which uses `persistentMultipleTabManager`.

* **Conflict:** Firestore's modern SDK handles multi-tab state synchronization natively (via IndexedDB). Manual broadcast channels in `useTabSync` might be fighting with the SDK or duplicating effort.

**Improvement:** Audit `useTabSync`. If it's just syncing the timer state, verify if Firestore `onSnapshot` (which you use in `useSyncActiveSession`) is fast enough. If so, delete `useTabSync` to reduce complexity.

---

### **New Issue Drafts**

Here are the drafts for these findings.

#### Issue 15: Codebase Cleanup (Dead Code)

**Title:**
`[Chore] Remove Dead Code, Old Components, and Redundant Files`

**Body:**

## Description
The codebase currently contains several backup files, "old" versions of pages, and experimental components that are no longer in use. This creates technical debt and confusion during development.

**Target Files to Delete:**
- `app/(authed)/dashboard/_components/Navbar2.tsx` & `Navbar3.tsx`
- `app/(authed)/dashboard/analytics/oldAnalyticsPage.tsx`
- `app/(authed)/dashboard/export-data/oldExportData.tsx`
- `app/(authed)/dashboard/goals/oldGoalsPage.tsx`
- `hooks/new/redundent/*` (Entire folder)

## Action Items
- [ ] **Verify:** Ensure no active code imports these files (search codebase).
- [ ] **Delete:** Remove the files.
- [ ] **Check:** Run build to ensure no breaking changes.

## Labels
`chore`, `maintenance`


#### Issue 16: Centralize Data Adapters

**Title:**
`[Refactor] Centralize Data Transformation in Adapter Pattern`

**Body:**

## Description
As identified in the V3 Roadmap, data transformation logic (converting raw Firestore docs to UI types) is scattered. We need to enforce the Adapter Pattern to decouple the UI from the Database schema.

**Current State:**
- Hooks like `useSessionsQuery` might be returning raw data or doing ad-hoc mapping.
- `lib/adapter.ts` exists but might not be fully utilized.

## Action Items
- [ ] **Audit Hooks:** Check `useSessionsQuery` and `useGoalsQuery`.
- [ ] **Refactor:** Move all "Doc -> Object" mapping logic into `lib/adapter.ts`.
    - Example: `export function sessionAdapter(doc: DocumentSnapshot): Session { ... }`
- [ ] **Implement:** Update hooks to use these adapter functions before returning data to the UI.

## Labels
`refactor`, `architecture`

#### Issue 17: Audit Multi-Tab Sync Logic

**Title:**
`[Refactor] Audit and Remove Redundant Multi-Tab Sync`

**Body:**

## Description
We are currently initializing Firestore with `persistentMultipleTabManager`, which handles cross-tab synchronization of data natively.

We also have a custom hook `hooks/useTabSync.ts`. We need to verify if this hook is redundant.

**Investigation:**
- Does `useTabSync` handle things Firestore misses (e.g., pure client-side timer states that aren't in DB)?
- If `useSyncActiveSession` listens to Firestore, and Firestore syncs across tabs, do we need `useTabSync`?

## Action Items
- [ ] **Analyze:** Compare functionality of `useTabSync` vs `useSyncActiveSession`.
- [ ] **Test:** Open app in two tabs. Start timer in Tab A. Does Tab B update via Firestore listener alone?
- [ ] **Cleanup:** If Firestore is sufficient, delete `hooks/useTabSync.ts`.

## Labels
`refactor`, `performance`
